{% comment %}
  Renders a product card

  Accepts:
  - card_product: {Object} Product Liquid object (optional)
  - media_aspect_ratio: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
  - image_shape: {String} Image mask to apply to the product image card. Values are "arch", "blob", "chevronleft", "chevronright", "diamond", "parallelogram", and "round". (optional)
  - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
  - show_vendor: {Boolean} Show the product vendor. Default: false
  - show_rating: {Boolean} Show the product rating. Default: false
  - extend_height: {Boolean} Card height extends to available container space. Default: true (optional)
  - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)
  - skip_styles: {Boolean} Don't include component styles. Useful when rendering multiple product cards in a loop. Default: false (optional)
  - quick_add: {Boolean} Show the quick add button.
  - section_id: {String} The ID of the section that contains this card.
  - horizontal_class: {Boolean} Add a card--horizontal class if set to true. Default: false (optional)
  - horizontal_quick_add: {Boolean} Changes the quick add button styles when set to true. Default: false (optional)
  - placeholder_image: {String} The placeholder image to use when no product exists. Default: 'product-apparel-2' (optional)

  Usage:
  {% render 'card-product', show_vendor: section.settings.show_vendor %}
{% endcomment %}


{%- if card_product and card_product != empty -%}
    <div class="card">
        <div class="card__img">
            <img src="{{ card_product.featured_media | image_url }}" alt="">
        </div>
        <div class="card__content">
            <div class="card__title">
                <h3><a href="{{ card_product.url }}">{{ card_product.title | escape }}</a></h3>
            </div>
            {% assign product_form_id = 'quick-add-' | append: section_id | append: card_product.id %}
            {% if quick_add == 'standard' %}
                <div class="quick-add no-js-hidden">
                    {%- liquid
                        assign qty_rules = false
                        if card_product.selected_or_first_available_variant.quantity_rule.min > 1 or card_product.selected_or_first_available_variant.quantity_rule.max != null or card_product.selected_or_first_available_variant.quantity_rule.increment > 1
                            assign qty_rules = true
                        endif
                    -%}
                    {%- if card_product.variants_count > 1 or qty_rules -%}
                        <modal-opener data-modal="#QuickAdd-{{ card_product.id }}">
                            <button
                                    id="{{ product_form_id }}-submit"
                                    type="submit"
                                    name="add"
                                    class="card__button"
                                    aria-haspopup="dialog"
                                    aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                                    data-product-url="{{ card_product.url }}"
                            >
                                {{ 'products.product.choose_options' | t }}
                                {%- render 'loading-spinner' -%}
                            </button>
                        </modal-opener>
                        <quick-add-modal id="QuickAdd-{{ card_product.id }}" class="quick-add-modal">
                            <div
                                    role="dialog"
                                    aria-label="{{ 'products.product.choose_product_options' | t: product_name: card_product.title | escape }}"
                                    aria-modal="true"
                                    class="quick-add-modal__content global-settings-popup"
                                    tabindex="-1"
                            >
                                <button
                                        id="ModalClose-{{ card_product.id }}"
                                        type="button"
                                        class="quick-add-modal__toggle"
                                        aria-label="{{ 'accessibility.close' | t }}"
                                >
                                    {{- 'icon-close.svg' | inline_asset_content -}}
                                </button>
                                <div id="QuickAddInfo-{{ card_product.id }}" class="quick-add-modal__content-info"></div>
                            </div>
                        </quick-add-modal>
                    {%- else -%}
                        <product-form data-section-id="{{ section.id }}">
                            {%- form 'product',
                                    card_product,
                                    id: product_form_id,
                                    class: 'form',
                                    novalidate: 'novalidate',
                                    data-type: 'add-to-cart-form'
                            -%}
                                <input
                                        type="hidden"
                                        name="id"
                                        value="{{ card_product.selected_or_first_available_variant.id }}"
                                        class="product-variant-id"
                                        {% if card_product.selected_or_first_available_variant.available == false %}
                                            disabled
                                        {% endif %}
                                >
                                <button
                                        id="{{ product_form_id }}-submit"
                                        type="submit"
                                        name="add"
                                        class="card__button"
                                        aria-haspopup="dialog"
                                        aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                                        aria-live="polite"
                                        data-sold-out-message="true"
                                        {% if card_product.selected_or_first_available_variant.available == false %}
                                            disabled
                                        {% endif %}
                                >
                                    <span>
                                      {%- if card_product.selected_or_first_available_variant.available -%}
                                          Add to cart - {{ card_product.price | money }}
                                      {%- else -%}
                                          {{ 'products.product.sold_out' | t }}
                                      {%- endif -%}
                                    </span>
                                    <span class="sold-out-message hidden">
                                      {{ 'products.product.sold_out' | t }}
                                    </span>
                                    {%- render 'loading-spinner' -%}
                                </button>
                            {%- endform -%}
                        </product-form>
                    {%- endif -%}
                </div>
            {% endif %}
        </div>
    </div>
{%- endif -%}
